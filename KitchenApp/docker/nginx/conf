events {}

http {
    upstream auths {
        server authservice;
    }

    upstream users {
        server userservice;
    }

    server {
        server_name kitchen.app;

        location /login {
           proxy_pass http://auths/login;
        }

        location /signup {
           proxy_pass http://auths/signup;
        }

        location /auth {
            internal;
            proxy_method GET;
            proxy_pass_request_body off;
            proxy_set_header Content-Length 0;
            proxy_pass http://auths/auth;
        }

        location /user/ {
            auth_request /auth;
            auth_request_set $auth_header_auth $upstream_http_header_auth;
            proxy_pass http://users/;
        }
    }
}

