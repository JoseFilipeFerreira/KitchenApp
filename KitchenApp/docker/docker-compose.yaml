version: "3.8"
services:
    authservice:
        build:
            dockerfile: docker/auth-docker
            context: ..
        restart: on-failure
        depends_on: 
            - db
        networks: 
            - db
            - proxy
        expose: 
            - "80"
    userservice:
        build:
            dockerfile: docker/user-docker
            context: ..
        depends_on: 
            - db
        networks:
            - db
            - proxy
        restart: on-failure
        expose: 
            - "80"
    products:
        build:
            dockerfile: docker/product-docker
            context: ..
        depends_on: 
            - db
        networks:
            - db
            - proxy
        expose: 
            - "80"
        restart: on-failure
    inventory:
        build:
            dockerfile: docker/inventory-docker
            context: ..
        depends_on: 
            - db
        networks:
            - db
            - proxy
        expose: 
            - "80"
        restart: on-failure
    wishlist:
        build:
            dockerfile: docker/wishlist-docker
            context: ..
        depends_on: 
            - db
        networks:
            - db
            - proxy
        expose: 
            - "80"
        restart: on-failure
    shopping:
        build:
            dockerfile: docker/shopping-docker
            context: ..
        depends_on: 
            - db
        networks:
            - db
            - proxy
        expose: 
            - "80"
        restart: on-failure
    db:
        build:
            dockerfile: db-docker
            context: .
        environment:
            - NEO4J_AUTH=neo4j/APPmvc
        volumes:
            - ./db/products.cypher:/var/lib/neo4j/data/products.cypher
        expose: 
            - "7687"
            - "7474"
        ports: 
            - 7687:7687
            - 7474:7474
        networks:
            - db
        restart: on-failure
    nginx:
        image: nginx:latest
        ports:
            - 1331:80
        volumes: 
            - ./nginx/conf:/etc/nginx/nginx.conf
        depends_on:
            - authservice
            - userservice
            - inventory
            - wishlist
            - shopping
        networks:
            - proxy
        restart: on-failure

networks: 
    db:
    proxy:
